var mqtt = require('mqtt');

// MQTT Setup
const mqtt_user = ''
const mqtt_pass = ''
const mqtt_topic = ''
var client = mqtt.connect('mqtt://mqtt.vehicleon.cloud:1883', {username: mqtt_user, password: mqtt_pass})

client.on('connect', function() {
    var counter = 0
    var message_no = 0
    const data = [40.51428269879674, 83.22832376139552, 33.87419792597962, 46.579633190020544, 84.98027275053633, 24.530488936178507,
        59.01835964843818, 43.52607771139522, 49.43266577426024, 44.22808182529595, 85.95577667029022, 21.306420970086194, 14.960378615194358, 
        97.92827533761398, 89.62037022760947, 26.442054562245076, 73.51197238458329, 62.918337579688696, 40.96758897811941, 85.02997874766768,
        47.374392047692545, 38.117887817301835, 2.0108632803330306, 20.81058186954192, 48.164663513071815, 88.23910335869994, 30.06887125057419,
        47.597469058860774, 77.12533619518811, 33.03464264334778, 60.39780377186838, 30.2960316639027, 57.773794612789686, 48.50266981018518,
        10.242072857516593, 34.5261480168799, 45.438124207851786, 15.307092390469457, 41.671938692379854, 76.68609264178447, 68.68656039948135,
        64.20733983644465, 53.78139430656527, 74.07250131730974, 5.855030456044375, 28.19749852340907, 12.070439367746399, 24.1953020577119,
        47.97865309776198, 85.04091046628169, 58.04834805464297, 58.025186004271426, 55.64311713289508, 76.11839868095383, 85.21561729792518,
        17.64192928081867, 67.09089421868866, 27.772413486099712, 24.325259187767912, 32.77489620825618, 66.56010672373056, 71.62327135720031,
        7.343435346648586, 76.34328158915983, 70.8278355011721, 31.258852071796895, 14.474438911661657, 80.73970482333915, 49.516775131952016, 
        15.516547357476584, 33.40429880933219, 0.07600046692218809, 35.058353194861134, 10.528990181678044, 86.5538483334801, 4.069386844538436,
        22.707353933310827, 18.618648150663997, 75.49563278816389, 49.554890896712145, 81.48312256099943, 59.59213895191257, 21.352097968582505, 
        33.654114064323046, 38.283455311602474, 44.46297323095332, 35.31422745008984, 3.6006323584614752, 67.66127519274755, 25.386495764112283,
        22.618934377387777, 47.726606857744336, 8.433460893624211, 75.5789409172561, 9.655965566422598, 53.7032459037732, 16.676731197659546,
        32.489811815109334, 54.23924597059157, 82.10660833528881]
        
    const topic = mqtt_topic
    const topic_list = ['Humidity_indoor', 'Temperature_indoor', 'Dust_indoor', 'Dust_outdoor', 'Rain', 'Light', 'Humidity_outdoor', 'Temperature_outdoor']
    setInterval(() => {
        if (message_no % 1000 < 2) {
            console.log(message_no + ' ' + (new Date()).getMinutes() + ':' + (new Date()).getSeconds() + ':' + (new Date()).getMilliseconds())
        }
        if (counter > 99) counter = 0
        if (counter >= 0 && counter < 8) {
            client.publish(topic + topic_list[counter], (new Date()).getTime()/1000 + ',' + data[counter] + ',' + message_no++)
        }
        if (counter == 8) {
            client.publish(topic + 'Gps', '13.698757,100.395915,A' + ',' + (new Date()).getTime()/1000 + ',' + (new Date()).getTime()/1000 + ',' + message_no++)
        }
        client.publish(topic + 'Acceleration',(new Date()).getTime()/1000 + ',' + data[counter] + ',' + message_no++)
        counter++
    }, 1)
})